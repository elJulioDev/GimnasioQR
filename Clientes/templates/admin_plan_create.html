{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Plan - ClubHouse Digital</title>
    <link rel="stylesheet" href="{% static 'css/indexAdmin.css' %}">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <style>
        /* Incluye aquí tus estilos CSS existentes o referencia el archivo */
        .creation-container { max-width: 900px; margin: 2rem auto; padding: 2rem; }
        .creation-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem; }
        .creation-header h1 { display: flex; align-items: center; gap: 1rem; font-size: 1.8rem; color: var(--text-primary); }
        .back-btn { padding: 0.75rem 1.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-primary); text-decoration: none; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; }
        .back-btn:hover { background: rgba(255, 255, 255, 0.1); border-color: var(--primary-color); }
        .form-card { background: rgba(255, 255, 255, 0.06); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 2rem; margin-bottom: 1.5rem; }
        .form-section-title { font-size: 1.2rem; color: var(--primary-color); margin-bottom: 1.5rem; padding-bottom: 0.75rem; border-bottom: 2px solid rgba(0, 255, 157, 0.2); }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem; font-weight: 500; }
        .form-group label .required { color: var(--danger-color); }
        .form-input { padding: 0.875rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 10px; color: var(--text-primary); font-size: 0.95rem; transition: all 0.3s ease; }
        .form-input:focus { outline: none; border-color: var(--primary-color); background: rgba(255, 255, 255, 0.08); }
        .checkbox-group { display: flex; align-items: center; gap: 0.75rem; padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 10px; }
        .checkbox-group input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
        .radio-group { display: flex; gap: 1rem; }
        .radio-option { flex: 1; position: relative; }
        .radio-option input[type="radio"] { position: absolute; opacity: 0; }
        .radio-label { display: block; padding: 0.875rem; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 10px; text-align: center; cursor: pointer; transition: all 0.3s ease; }
        .radio-option input[type="radio"]:checked + .radio-label { background: rgba(0, 255, 157, 0.1); border-color: var(--primary-color); color: var(--primary-color); }
        .form-actions { display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem; }
        .btn { padding: 0.875rem 2rem; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; }
        .btn-primary { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: #000; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0, 255, 157, 0.3); }
        .btn-secondary { background: rgba(255, 255, 255, 0.05); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.1); }
        .loading { pointer-events: none; opacity: 0.6; }
    </style>
</head>
<body>
    <div class="creation-container">
        <div class="creation-header">
            <h1><i class='bx bx-card'></i> Crear Nuevo Plan</h1>
            <a href="{% url 'index_admin' %}" class="back-btn">
                <i class='bx bx-arrow-back'></i> Volver al Panel
            </a>
        </div>

        <form id="createPlanForm">
            {% csrf_token %}

            <div class="form-card">
                <h3 class="form-section-title"><i class='bx bx-info-circle'></i> Información Básica</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nombre del Plan <span class="required">*</span></label>
                        <input type="text" name="name" class="form-input" placeholder="Ej: Plan Premium" required>
                    </div>
                    <div class="form-group">
                        <label>Descripción <span class="required">*</span></label>
                        <input type="text" name="description" class="form-input" placeholder="Descripción del plan" required>
                    </div>
                </div>
            </div>

            <div class="form-card">
                <h3 class="form-section-title"><i class='bx bx-category'></i> Tipo de Plan</h3>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="plan_type" value="basico" id="typeBasic" required>
                        <label for="typeBasic" class="radio-label">
                            <i class='bx bx-star' style="font-size: 1.5rem; display: block; margin-bottom: 0.5rem;"></i>
                            Básico
                        </label>
                    </div>

                    <div class="radio-option">
                        <input type="radio" name="plan_type" value="estandar" id="typeStandard">
                        <label for="typeStandard" class="radio-label">
                            <i class='bx bx-medal' style="font-size: 1.5rem; display: block; margin-bottom: 0.5rem;"></i>
                            Estándar
                        </label>
                    </div>

                    <div class="radio-option">
                        <input type="radio" name="plan_type" value="premium" id="typePremium">
                        <label for="typePremium" class="radio-label">
                            <i class='bx bx-trophy' style="font-size: 1.5rem; display: block; margin-bottom: 0.5rem;"></i>
                            Premium
                        </label>
                    </div>
                </div>
            </div>

            <div class="form-card">
                <h3 class="form-section-title"><i class='bx bx-dollar-circle'></i> Precios y Duración</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Precio (CLP) <span class="required">*</span></label>
                        <input type="number" name="price" class="form-input" placeholder="Ej: 25000" min="0" step="100" required>
                    </div>

                    <div class="form-group">
                        <label>Duración (días) <span class="required">*</span></label>
                        <input type="number" name="duration_days" class="form-input" placeholder="30" min="1" required>
                    </div>

                    <div class="form-group">
                        <label>Días de Acceso <span class="required">*</span></label>
                        <input type="number" name="access_days" class="form-input" placeholder="30" min="1" required>
                    </div>
                </div>
            </div>

            <div class="form-card">
                <h3 class="form-section-title"><i class='bx bx-star'></i> Beneficios y Extras</h3>
                <div class="checkbox-group">
                    <input type="checkbox" name="includes_classes" id="includesClasses" value="true">
                    <label for="includesClasses" style="color: var(--text-primary); cursor: pointer;">Incluye Clases Grupales</label>
                </div>
                <div class="checkbox-group" style="margin-top: 10px;">
                    <input type="checkbox" name="includes_nutritionist" id="includesNutritionist" value="true">
                    <label for="includesNutritionist" style="color: var(--text-primary); cursor: pointer;">Incluye Nutricionista</label>
                </div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label>Beneficios Adicionales (Separar con comas)</label>
                    <textarea name="benefits" class="form-input" rows="3" placeholder="Ej: Casillero personal, Toalla gratis, Descuento en suplementos"></textarea>
                </div>
            </div>

            <div class="form-card">
                <h3 class="form-section-title"><i class='bx bx-toggle-left'></i> Estado del Plan</h3>
                <div class="checkbox-group">
                    <input type="checkbox" name="is_active" id="isActive" value="true" checked>
                    <label for="isActive" style="color: var(--text-primary); cursor: pointer;">Plan Activo (Los usuarios podrán contratar este plan)</label>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="window.location.href='{% url 'index_admin' %}'">
                    <i class='bx bx-x'></i> Cancelar
                </button>
                <button type="submit" class="btn btn-primary" id="submitBtn">
                    <i class='bx bx-check'></i> Crear Plan
                </button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('createPlanForm');
            const submitBtn = document.getElementById('submitBtn');

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(form);
                const data = {
                    name: formData.get('name'),
                    description: formData.get('description'),
                    plan_type: formData.get('plan_type'),
                    price: parseFloat(formData.get('price')),
                    duration_days: parseInt(formData.get('duration_days')),
                    access_days: parseInt(formData.get('access_days')),
                    includes_classes: formData.get('includes_classes') === 'true',
                    includes_nutritionist: formData.get('includes_nutritionist') === 'true',
                    benefits: formData.get('benefits') || '',
                    is_active: formData.get('is_active') === 'true'
                };

                submitBtn.classList.add('loading');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="bx bx-loader bx-spin"></i> Creando...';

                try {
                    const response = await fetch('{% url "admin_plan_create" %}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert('✅ ' + result.message);
                        window.location.href = '{% url "index_admin" %}';
                    } else {
                        alert('❌ Error: ' + result.error);
                    }
                } catch (error) {
                    alert('❌ Error al crear plan: ' + error.message);
                } finally {
                    submitBtn.classList.remove('loading');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="bx bx-check"></i> Crear Plan';
                }
            });
        });
    </script>
</body>
</html>