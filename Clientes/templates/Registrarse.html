{% load static %}
{% load qr_tags %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - ClubHouse Digital</title>
    <meta name="csrf-token" content="{{ csrf_token }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/Registrarse.css' %}">
    <link rel="icon" type="image/svg+xml" href="{% static 'img/icono.svg' %}">
</head>
<body>

    <div class="bg-decoration bg-decoration-1"></div>
    <div class="bg-decoration bg-decoration-2"></div>

    <div class="main-wrapper">
        <div class="register-card">
            
            <div class="card-sidebar">
                <div class="sidebar-header">
                    <div class="logo-icon"><i class="fas fa-dumbbell"></i></div>
                    <span>ClubHouse</span>
                </div>

                <div class="progress-vertical">
                    <div class="step-item active" data-step="1">
                        <div class="step-indicator">1</div>
                        <div class="step-text">
                            <strong>Elige tu Plan</strong>
                            <span>Comienza aquí</span>
                        </div>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" data-step="2">
                        <div class="step-indicator">2</div>
                        <div class="step-text">
                            <strong>Tus Datos</strong>
                            <span>Información personal</span>
                        </div>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" data-step="3">
                        <div class="step-indicator">3</div>
                        <div class="step-text">
                            <strong>Pago</strong>
                            <span>Finalizar</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar-footer">
                    <p>¿Ya tienes cuenta?</p>
                    <a href="{% url 'inicio_sesion' %}" class="btn-outline-sm">Iniciar Sesión</a>
                </div>
            </div>

            <div class="card-content">
                <form id="registerForm" data-url-registro="{% url 'process_registration' %}" data-url-login="{% url 'inicio_sesion' %}">
                    {% csrf_token %}

                    <div class="step-panel active" id="step1">
                        <div class="panel-header">
                            <h2>Selecciona tu Objetivo</h2>
                            <p>Elige el plan que mejor se adapte a tu ritmo.</p>
                        </div>

                        <div class="plans-scroll-container">
                            {% for plan in plans %}
                            <label class="plan-card-horizontal">
                                <input type="radio" name="selected_plan" value="{{ plan.plan_type }}" 
                                    data-price="{{ plan.price }}" 
                                    data-name="{{ plan.name }}"
                                    onclick="selectPlan(this)">
                                
                                {% if plan.plan_type == 'completo' or plan.plan_type == 'vip' %}
                                    <div class="horizontal-badge">RECOMENDADO</div>
                                {% endif %}

                                <div class="plan-horizontal-content">
                                    <div class="plan-header-row">
                                        <span class="plan-name">{{ plan.name }}</span>
                                        <div class="plan-price">
                                            ${{ plan.price|floatformat:0 }}<span>/mes</span>
                                        </div>
                                    </div>

                                    {% if plan.description %}
                                        <p class="plan-description-text">
                                            {{ plan.description }}
                                        </p>
                                    {% endif %}

                                    <div class="plan-features-grid">
                                        <div class="feature-item">
                                            <i class="fas fa-calendar-alt"></i> {{ plan.access_days }}
                                        </div>
                                        <div class="feature-item">
                                            <i class="fas fa-clock"></i> {{ plan.duration_days }} días
                                        </div>
                                        
                                        {% if plan.includes_classes %}
                                            <div class="feature-item">
                                                <i class="fas fa-dumbbell"></i> Clases Grupales
                                            </div>
                                        {% endif %}
                                        
                                        {% if plan.includes_nutritionist %}
                                            <div class="feature-item">
                                                <i class="fas fa-apple-alt"></i> Nutricionista
                                            </div>
                                        {% endif %}

                                        {% if plan.benefits %}
                                            <div class="feature-item" style="grid-column: 1 / -1; color: #fff;">
                                                <i class="fas fa-star" style="color: gold;"></i> {{ plan.benefits }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="select-indicator-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </label>
                            {% endfor %}
                        </div>

                        <div class="panel-actions">
                            <button type="button" class="btn btn-primary" id="btnStep1" onclick="nextStep()" disabled>
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <div class="step-panel" id="step2">
                        <div class="panel-header">
                            <h2>Crea tu Perfil</h2>
                            <p>Datos necesarios para generar tu acceso QR.</p>
                        </div>

                        <div class="compact-form-grid">
                            <div class="form-group">
                                <label>RUT</label>
                                <input type="text" id="rut" name="rut" placeholder="12.345.678-9" required>
                            </div>
                            <div class="form-group">
                                <label>Fecha Nacimiento</label>
                                <input type="date" id="birthdate" name="birthdate" required>
                            </div>
                            <div class="form-group">
                                <label>Nombre</label>
                                <input type="text" id="firstName" name="firstName" placeholder="Tu nombre" required>
                            </div>
                            <div class="form-group">
                                <label>Apellido</label>
                                <input type="text" id="lastName" name="lastName" placeholder="Tu apellido" required>
                            </div>
                            <div class="form-group full-width">
                                <label>Email</label>
                                <input type="email" id="email" name="email" placeholder="correo@ejemplo.com" required>
                            </div>
                            <div class="form-group">
                                <label>Teléfono</label>
                                <input type="tel" id="phone" name="phone" placeholder="+56 9..." required>
                            </div>
                            <div class="form-group">
                                <label>Contraseña</label>
                                <input type="password" id="password" name="password" placeholder="Min 8 caracteres" required>
                            </div>
                            <div class="form-group">
                                <label>Confirmar</label>
                                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Repetir contraseña" required>
                            </div>
                        </div>

                        <div class="panel-actions">
                            <button type="button" class="btn btn-text" onclick="prevStep()">Volver</button>
                            <button type="button" class="btn btn-primary" onclick="nextStep()">
                                Ir al Pago <i class="fas fa-credit-card"></i>
                            </button>
                        </div>
                    </div>

                    <div class="step-panel" id="step3">
                        <div class="panel-header">
                            <h2>Finalizar Inscripción</h2>
                            <p>Selecciona tu método de pago preferido.</p>
                        </div>

                        <div class="payment-summary-box">
                            <div class="summary-row">
                                <span id="summaryPlanName">Plan Seleccionado</span>
                                <strong id="summaryPlanPrice">$0</strong>
                            </div>
                        </div>

                        <div class="payment-options-grid">
                            <label class="payment-option">
                                <input type="radio" name="paymentMethod" value="transferencia" onclick="enablePayment()">
                                <div class="option-content">
                                    <i class="fas fa-university"></i>
                                    <span>Transferencia</span>
                                    <small>Datos bancarios</small>
                                </div>
                            </label>
                            <label class="payment-option">
                                <input type="radio" name="paymentMethod" value="tarjeta" onclick="enablePayment()">
                                <div class="option-content">
                                    <i class="fas fa-credit-card"></i>
                                    <span>Tarjeta</span>
                                    <small>Débito/Crédito</small>
                                </div>
                            </label>
                        </div>

                        <div class="options-stack">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="sendQREmail" name="sendQREmail" checked>
                                <label for="sendQREmail">
                                    Enviar código QR de acceso al correo
                                    <small style="display:block; color:#666; font-size:0.75em;">Necesario para entrar al gimnasio</small>
                                </label>
                            </div>

                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="sendContract" name="sendContract" checked>
                                <label for="sendContract">
                                    Generar y enviar Contrato de Socio (PDF)
                                    <small style="display:block; color:#666; font-size:0.75em;">Incluye términos, condiciones y datos del plan</small>
                                </label>
                            </div>
                        </div>

                        <div class="panel-actions">
                            <button type="button" class="btn btn-text" onclick="prevStep()">Volver</button>
                            <button type="button" class="btn btn-primary" id="btnPayment" onclick="processPayment()" disabled>
                                Confirmar y Registrarse
                            </button>
                        </div>
                    </div>

                    <div class="step-panel" id="step4">
                        <div class="success-wrapper">
                            
                            <div class="success-header">
                                <div class="success-icon-anim">
                                    <div class="ripple"></div>
                                    <i class="fas fa-check"></i>
                                </div>
                                <h2>¡Bienvenido al Team!</h2>
                                <p>Tu cuenta está lista. Este es tu pase digital.</p>
                            </div>

                            <div class="digital-pass">
                                <div class="pass-top">
                                    <span class="pass-label">MEMBER ACCESS</span>
                                    <div class="pass-holes"></div>
                                </div>
                                
                                <div class="qr-frame-wrapper">
                                    <div class="corner-border topleft"></div>
                                    <div class="corner-border topright"></div>
                                    <div class="corner-border bottomleft"></div>
                                    <div class="corner-border bottomright"></div>
                                    
                                    <div id="qrContainer" class="qr-content"></div>
                                </div>

                                <p class="scan-instruction">
                                    <i class="fas fa-wifi"></i> Escanea en recepción
                                </p>
                            </div>

                            <div class="success-footer">
                                <div class="info-pill">
                                    <i class="fas fa-envelope-open-text"></i>
                                    <span>Copia enviada a tu correo</span>
                                </div>
                                
                                <button type="button" class="btn btn-primary btn-block glow-effect" onclick="goToLogin()">
                                    Iniciar Sesión y Entrenar
                                </button>
                            </div>

                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>

    <div id="customModal" class="custom-modal-overlay">
        <div class="custom-modal">
            <div class="modal-icon-box error" id="modalIcon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3 class="modal-title" id="modalTitle">Error</h3>
            <p class="modal-text" id="modalMessage">Mensaje de error aquí.</p>
            <button class="btn btn-primary modal-btn" onclick="closeCustomModal()">Entendido</button>
        </div>
    </div>
    <script src="{% static 'js/registrarse.js' %}"></script>
</body>
</html>